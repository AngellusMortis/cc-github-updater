name: Promote Version

on:
  workflow_dispatch:

jobs:
  manifest:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: Bump Version
      run: bash ./bump.sh

    - name: Commit Changes
      run: |
        git config user.name github-actions
        git config user.email github-actions@github.com
        git add manifest.json
        git commit -m "Generate new manifest"
        git push

    - name: Create Tags
      run: |
        majorTag=v$(bash ./getMajor.sh)

        git tag -d $majorTag
        git push --delete origin $majorTag
        git tag $majorTag
        git tag v$(cat ./version.txt)

        git push --tags
